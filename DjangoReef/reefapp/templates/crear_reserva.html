{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- 游댳 Secci칩n para crear reserva -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Progress Bar -->
            <div class="progress mb-5" style="height: 8px;">
                <div class="progress-bar bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100"
                    aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <div class="row">
                <!-- Informaci칩n de la Habitaci칩n -->
                <div class="col-md-8">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="fas fa-bed me-2"></i>Confirmar Reserva
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="{% get_static_prefix %}img/habitaciones/{{ habitacion.tipo }}.jpg"
                                        class="img-fluid rounded" alt="{{ habitacion.get_tipo_display }}"
                                        onerror="this.src='{% get_static_prefix %}img/habitaciones/default.jpg'">
                                </div>
                                <div class="col-md-8">
                                    <h5 class="card-title">Habitaci칩n {{ habitacion.numero }}</h5>
                                    <p class="text-muted">{{ habitacion.descripcion }}</p>

                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <strong><i class="fas fa-star me-2 text-warning"></i>Categor칤a:</strong>
                                            <br>{{ habitacion.categoria.nombre }}
                                        </div>
                                        <div class="col-6">
                                            <strong><i class="fas fa-users me-2 text-info"></i>Capacidad:</strong>
                                            <br>{{ habitacion.capacidad_adultos }} adultos + {{
                                            habitacion.capacidad_ninos }} ni침os
                                        </div>
                                    </div>

                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <strong><i class="fas fa-building me-2 text-secondary"></i>Piso:</strong>
                                            <br>{{ habitacion.piso }}
                                        </div>
                                        <div class="col-6">
                                            <strong><i
                                                    class="fas fa-ruler-combined me-2 text-success"></i>Tipo:</strong>
                                            <br>{{ habitacion.get_tipo_display }}
                                        </div>
                                    </div>

                                    <!-- Mostrar precio real de la habitaci칩n -->
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <strong><i class="fas fa-tag me-2 text-primary"></i>Precio por
                                                noche:</strong>
                                            <span class="h5 text-success ms-2">${{ habitacion.precio_base|floatformat:0
                                                }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de Reserva -->
                    <div class="card shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-calendar-alt me-2"></i>Detalles de la Reserva
                            </h5>
                        </div>
                        <div class="card-body">
                            <form method="POST">
                                {% csrf_token %}

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label"><strong>Fecha de Check-in</strong></label>
                                        <input type="date" class="form-control" name="fecha_checkin" id="fecha_checkin"
                                            value="{{ request.GET.checkin|date:'Y-m-d' }}" min="{% now 'Y-m-d' %}"
                                            required>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label"><strong>Fecha de Check-out</strong></label>
                                        <input type="date" class="form-control" name="fecha_checkout"
                                            id="fecha_checkout" value="{{ request.GET.checkout|date:'Y-m-d' }}"
                                            min="{% now 'Y-m-d' %}" required>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label"><strong>Adultos</strong></label>
                                        <select class="form-select" name="adultos" required>
                                            <option value="1" {% if request.GET.adults=="1" %}selected{% endif %}>1
                                                adulto</option>
                                            <option value="2" {% if request.GET.adults=="2" %}selected{% endif %}>2
                                                adultos</option>
                                            <option value="3" {% if request.GET.adults=="3" %}selected{% endif %}>3
                                                adultos</option>
                                            <option value="4" {% if request.GET.adults=="4" %}selected{% endif %}>4
                                                adultos</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label"><strong>Ni침os</strong></label>
                                        <select class="form-select" name="ninos">
                                            <option value="0" {% if request.GET.children=="0" %}selected{% endif %}>0
                                                ni침os</option>
                                            <option value="1" {% if request.GET.children=="1" %}selected{% endif %}>1
                                                ni침o</option>
                                            <option value="2" {% if request.GET.children=="2" %}selected{% endif %}>2
                                                ni침os</option>
                                            <option value="3" {% if request.GET.children=="3" %}selected{% endif %}>3
                                                ni침os</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label"><strong>Observaciones Especiales</strong></label>
                                    <textarea class="form-control" name="observaciones" rows="3"
                                        placeholder="Alergias alimentarias, necesidades especiales, preferencias..."></textarea>
                                </div>

                                <!-- Informaci칩n del pago del 30% -->
                                <div class="alert alert-warning">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-exclamation-triangle me-2"></i>Informaci칩n de Pago
                                    </h6>
                                    <p class="mb-2">
                                        Para confirmar tu reserva deber치s pagar el <strong>30% del total de la
                                            estad칤a</strong>.
                                    </p>
                                    <p class="mb-0">
                                        <strong>Pago de reserva:</strong> <span id="pago-reserva-text"
                                            class="text-success">$0</span><br>
                                        <strong>Saldo pendiente:</strong> <span id="saldo-pendiente-text"
                                            class="text-muted">$0</span> (a pagar al check-in)
                                    </p>
                                </div>

                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="terminos" required>
                                    <label class="form-check-label" for="terminos">
                                        Acepto los <a href="#" class="text-primary">t칠rminos y condiciones</a>
                                        y la <a href="#" class="text-primary">pol칤tica de cancelaci칩n</a>
                                    </label>
                                </div>

                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="{% url 'reserva' %}" class="btn btn-outline-secondary me-md-2">
                                        <i class="fas fa-arrow-left me-2"></i>Volver
                                    </a>
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-credit-card me-2"></i>Pagar Reserva (30%)
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Resumen de Pago ACTUALIZADO -->
                <div class="col-md-4">
                    <div class="card shadow-sm sticky-top" style="top: 20px;">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-receipt me-2"></i>Resumen de Pago
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Precio por noche -->
                            <div class="d-flex justify-content-between mb-2">
                                <span>Precio por noche:</span>
                                <strong>${{ habitacion.precio_base|floatformat:0 }}</strong>
                            </div>

                            <!-- Noches de estad칤a -->
                            <div class="d-flex justify-content-between mb-2">
                                <span>Noches de estad칤a:</span>
                                <strong id="noches-count">0 noches</strong>
                            </div>

                            <hr>

                            <!-- Subtotal -->
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal estad칤a:</span>
                                <strong id="subtotal-estadia">$0</strong>
                            </div>

                            <!-- Impuestos -->
                            <div class="d-flex justify-content-between mb-2">
                                <span>Impuestos (19%):</span>
                                <strong id="impuestos">$0</strong>
                            </div>

                            <!-- Servicio -->
                            <div class="d-flex justify-content-between mb-3">
                                <span>Servicio:</span>
                                <strong>$5.000</strong>
                            </div>

                            <hr>

                            <!-- TOTAL ESTAD칈A -->
                            <div class="d-flex justify-content-between mb-2">
                                <strong>Total Estad칤a:</strong>
                                <strong id="total-estadia" class="text-primary">$0</strong>
                            </div>

                            <!-- PAGO DE RESERVA (30%) -->
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-success"><strong>Pago de reserva (30%):</strong></span>
                                <strong id="pago-reserva" class="text-success">$0</strong>
                            </div>

                            <!-- SALDO PENDIENTE (70%) -->
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Saldo pendiente (70%):</span>
                                <strong id="saldo-pendiente" class="text-muted">$0</strong>
                            </div>

                            <hr>

                            <!-- TOTAL A PAGAR AHORA -->
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Total a pagar ahora:</h5>
                                <h5 id="total-pagar" class="text-success">$0</h5>
                            </div>

                            <div class="alert alert-info small">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Pol칤tica de pago:</strong>
                                Para confirmar la reserva se requiere el pago del 30%.
                                El saldo restante se paga al check-in.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block extra_js %}
<!-- Calcular la Reserva -->
<div id="datos-reserva" data-precio="{{ habitacion.precio_base }}" style="display: none;">
</div>

<script src="{% static 'js/calculosReserva.js' %}"></script>
{% endblock %}