{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- 🔹 Sección del registro -->
<!--Registro de usuario-->
<form method="POST" action="{% url 'registro' %}" class="row g-3 needs-validation p-4 border rounded shadow" novalidate>
    {% csrf_token %}
    
    <div class="col-12 text-center">
        <h2 class="mb-4">REGISTRO</h2>
    </div>

    <!-- Campo NOMBRE -->
    <div class="col-md-6">
        <label for="id_nombre" class="form-label">Nombres</label>
        {{ form.nombre }}
        {% if form.nombre.errors %}
            <div class="text-danger small">{{ form.nombre.errors }}</div>
        {% endif %}
    </div>

    <!-- Campo APELLIDO -->
    <div class="col-md-6">
        <label for="id_apellido" class="form-label">Apellidos</label>
        {{ form.apellido }}
        {% if form.apellido.errors %}
            <div class="text-danger small">{{ form.apellido.errors }}</div>
        {% endif %}
    </div>

    <!-- Campo CORREO -->
    <div class="col-md-6">
        <label for="id_correo" class="form-label">Correo Electrónico</label>
        <div class="input-group has-validation">
            <span class="input-group-text">@</span>
            {{ form.correo }}
        </div>
        {% if form.correo.errors %}
            <div class="text-danger small">{{ form.correo.errors }}</div>
        {% endif %}
    </div>

    <!-- Campo TELÉFONO -->
    <div class="col-md-6">
        <label for="id_telefono" class="form-label">Número de Teléfono</label>
        {{ form.telefono }}
        {% if form.telefono.errors %}
            <div class="text-danger small">{{ form.telefono.errors }}</div>
        {% endif %}
    </div>

    <!-- Campo DIRECCIÓN -->
    <div class="col-md-12">
        <label for="id_direccion" class="form-label">Dirección</label>
        {{ form.direccion }}
        {% if form.direccion.errors %}
            <div class="text-danger small">{{ form.direccion.errors }}</div>
        {% endif %}
    </div>

    <!-- Campo CONTRASEÑA 1 -->
    <div class="col-md-6">
        <label for="id_password1" class="form-label">Contraseña</label>
        {{ form.password1 }}
        {% if form.password1.errors %}
            <div class="text-danger small">{{ form.password1.errors }}</div>
        {% endif %}
    </div>

    <!-- Campo CONTRASEÑA 2 -->
    <div class="col-md-6">
        <label for="id_password2" class="form-label">Confirmar Contraseña</label>
        {{ form.password2 }}
        {% if form.password2.errors %}
            <div class="text-danger small">{{ form.password2.errors }}</div>
        {% endif %}
    </div>

    <div class="col-12">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="accept_terms" id="invalidCheck" required>
            <label class="form-check-label" for="invalidCheck">Acepto los términos y condiciones.</label>
            <div class="invalid-feedback">Debes aceptar los términos y condiciones.</div>
        </div>
    </div>

    <div class="col-12 text-center mt-4">
        <button class="btn-custom" type="submit">Registrar</button>
        <button class="btn-custom" type="reset">Limpiar</button>
    </div>
</form>

<!-- Mostrar mensajes de Django -->
{% if messages %}
    <div class="mt-3">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Mostrar errores del formulario -->
{% if form.errors %}
    <div class="alert alert-danger mt-3">
        <strong>Errores en el formulario:</strong>
        <ul>
            {% for field in form %}
                {% for error in field.errors %}
                    <li>{{ field.label }}: {{ error }}</li>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<script>
    // Validación personalizada de Bootstrap
    (() => {
      'use strict'
      const forms = document.querySelectorAll('.needs-validation')
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }
          form.classList.add('was-validated')
        }, false)
      })
    })()
</script>

{% endblock %}